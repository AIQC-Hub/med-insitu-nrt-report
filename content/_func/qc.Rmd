```{r, func_qc, message = FALSE, warning = FALSE}

get_flag_def <- function() {
  Code <- c("0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A")
  Definition <- c("No QC was performed",
                  "Good data",
                  "Probably good data",
                  "Bad data that are potentially correctable",
                  "Bad data",
                  "Value changed",
                  "Below detection limit",
                  "In excess of quoted value",
                  "Interpolated value",
                  "Missing value",
                  "Incomplete information")

  tibble(Code, Definition)
}

get_flag_counts <- function(df, var) {
  flag_counts <- df %>% mutate(x = {{ var }}) %>%
    count(x) %>% mutate(x = as.character(x))

  get_flag_def() %>%
    left_join(flag_counts, by=c(Code = "x")) %>%
    mutate(n = ifelse(is.na(n), 0, n),
           `Relative Frequency (%)` = scales::percent(n / sum(n), accuracy = 0.1),
           n = comma(n))
}


qc_summary_1 <- function(df, var_x) {
  df_counts <- df %>%
    group_by(platform_code, {{var_x}}) %>%
    summarise(n = n()) %>%
    ungroup() %>%
    complete(platform_code, {{var_x}}, fill = list(count = 0)) %>%
    mutate(n = ifelse(is.na(n), 0, n)) %>%
    pivot_wider(names_from = {{var_x}}, values_from = n)

  df %>%
    group_by(platform_code) %>% summarise(n = n()) %>%
    left_join(df_counts, by="platform_code")
}

format_qc_summary_1 <- function(df) {
  df %>%
    rename(`Platform` = platform_code, `# Observations` = n)
}

qc_summary_2 <- function(df, var_x) {
  df_counts <- df %>%
    group_by(platform_code, profile_no, {{var_x}}) %>%
    summarise(n = n()) %>%
    ungroup() %>%
    complete(platform_code, profile_no, {{var_x}}, fill = list(count = 0)) %>%
    mutate(n = ifelse(is.na(n), 0, n)) %>%
    pivot_wider(names_from = {{var_x}}, values_from = n)

  df %>%
    group_by(platform_code, profile_no) %>% summarise(n = n()) %>%
    left_join(df_counts, by=c("platform_code", "profile_no"))
}

format_qc_summary_2 <- function(df) {
  df %>%
    rename(`Platform code` = platform_code, `Profile` = profile_no, `# Obs` = n)
}

qc_summary_time <- function(df, var_x) {
  df_counts <- df %>%
    group_by(x, {{var_x}}) %>%
    summarise(n = n()) %>%
    ungroup() %>%
    complete(x, {{var_x}}, fill = list(count = 0)) %>%
    mutate(n = ifelse(is.na(n), 0, n)) %>%
    pivot_wider(names_from = {{var_x}}, values_from = n)

  df %>%
    group_by(x) %>% summarise(n = n()) %>%
    left_join(df_counts, by=c("x"))
}

format_qc_summary_year <- function(df) {
  df %>%
    rename(`Year` = x, `# Obs` = n)
}

format_qc_summary_month <- function(df) {
  df %>%
    rename(`Month` = x, `# Obs` = n)
}

```
