```{r, func_var, message = FALSE, warning = FALSE}

var_summary_1 <- function(df, var_x) {
  df %>%
    group_by(platform_code) %>%
    summarise(n = n(),
              min_x = min({{var_x}}, na.rm = TRUE),
              median_x = median({{var_x}}, na.rm = TRUE),
              mean_x = mean({{var_x}}, na.rm = TRUE),
              max_x = max({{var_x}}, na.rm = TRUE)) %>%
    ungroup()
}

format_var_summary_1 <- function(df, var_name) {
  df %>%
    select(`Platform` = 1, `# Obs` = 2,
           `Min(X)` = 3, `Median(X)` = 4, `Mean(X)` = 5, `Max(X)` = 6) %>%
    rename_with(~ gsub("X", var_name, .x, fixed = TRUE))
}

var_summary_3 <- function(df, var_x) {
  df %>%
    group_by(platform_code, profile_no) %>%
    summarise(profile_timestamp = first(profile_timestamp),
              longitude = first(longitude),
              latitude = first(latitude),
              min_x = min({{var_x}}, na.rm = TRUE),
              mean_x = mean({{var_x}}, na.rm = TRUE),
              median_x = median({{var_x}}, na.rm = TRUE),
              max_x = max({{var_x}}, na.rm = TRUE)) %>%
    ungroup()
}

create_var_boxplot <- function(df, y_title) {
  df <- df %>% select(x, Min=min_x, Max=max_x, Mean=mean_x, Median=median_x) %>%
    pivot_longer(!x, names_to = "group", values_to = "y") %>%
    mutate(group = factor(group, levels=c("Min", "Max", "Mean", "Median")))

  ggplot(df, aes(x=x, y=y)) +
    geom_boxplot(outlier.size = 0.1) +
    facet_wrap(vars(group), ncol = 1, scales = "free") +
    labs(x = NULL,
         y = y_title) +
    theme_pubr(base_size = 12) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

create_var_density <- function(df, var_x, y_title) {
  df <- df %>% select(x = {{var_x}}, Min=min_x, Max=max_x, Mean=mean_x, Median=median_x) %>%
    pivot_longer(!x, names_to = "group", values_to = "y") %>%
    mutate(group = factor(group, levels=c("Min", "Max", "Mean", "Median")))

  ggplot(df, aes(x=x, y=y)) +
    geom_point(alpha=0.25, size = 0.25)  +
    geom_smooth() +
    facet_wrap(vars(group), ncol = 1, scales = "free") +
    labs(x = deparse(substitute(var_x)),
         y = y_title) +
    theme_pubr(base_size = 12) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

```
